import{_ as pe,g as u,h as A,i as fe,o as ge,c as V,a as o,b as n,m as M,n as _e,r as g,w as s,t as c,l as I,j as ye,e as k,f as y,F as q,p as we,q as be,s as h}from"./index-AjeEuBR7.js";import{s as Ce}from"./function-call-ElmC6OtN.js";const ke={class:"data-management-page"},he={class:"search-section"},De={class:"search-input-row"},Ve={class:"filter-conditions"},xe={class:"condition-row"},Se={class:"record-type-selector"},Le={class:"date-range-row"},Me={class:"action-buttons"},Ee={key:0,class:"stats-section"},Ue={class:"stat-item"},Te={class:"stat-value"},$e={class:"stat-item"},Pe={class:"stat-value"},Re={class:"stat-item"},ze={class:"stat-value"},Ie={class:"records-section"},Oe={class:"record-header"},Ae={class:"record-date"},qe={class:"record-info"},He={class:"info-row"},Ye={class:"value"},Be={class:"info-row"},Ne={class:"value org-name"},Fe={class:"record-actions"},je={key:1,style:{padding:"10px",background:"#fff",margin:"10px","border-radius":"5px"}},Ge={key:0,class:"edit-form"},Je={__name:"DataManagement",setup(Ke){const d=u([]),v=u(!1),E=u(!1),m=u(!1),C=u(!0),_=u(1),O=u(20),r=u({recordType:"",startDate:"",endDate:"",keyword:""}),x=u(!1),S=u(!1),$=u(!1),L=u(!1);u(!1);const U=u(!1),t=u(null);u(null);const P=u([]),R=u([]),F=u([{text:"æœªå©š",value:"æœªå©š"},{text:"å·²å©š",value:"å·²å©š"}]),j=A(()=>d.value.length),G=A(()=>d.value.filter(l=>l.record_type==="CHILD").length),J=A(()=>d.value.filter(l=>l.record_type==="EMPLOYEE").length),K=l=>{const e=new Date(l);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},Q=l=>l==="CHILD"?"å„¿ç«¥ä½“æ£€":"ä»ä¸šäººå‘˜ä½“æ£€",H=l=>{if(!l){const i=new Date;return[i.getFullYear().toString(),String(i.getMonth()+1).padStart(2,"0"),String(i.getDate()).padStart(2,"0")]}const[e,p,f]=l.split("-");return[e,p,f]},W=({selectedValues:l})=>{r.value.startDate=l.join("-"),x.value=!1,w()},X=({selectedValues:l})=>{r.value.endDate=l.join("-"),S.value=!1,w()},Z=({value:l})=>{t.value.marital_status=l,$.value=!1},ee=()=>{d.value=[],w()},w=async(l=!1)=>{try{l?v.value=!0:(v.value=!0,m.value=!1,_.value=1,C.value=!0);const e={record_type:r.value.recordType,keyword:r.value.keyword,page:_.value,pageSize:O.value};r.value.startDate&&(e.date_from=r.value.startDate),r.value.endDate&&(e.date_to=r.value.endDate),console.log("ğŸ“Š å¼€å§‹åŠ è½½æ•°æ®:",{isLoadMore:l,searchParams:e});let p;if(e.record_type||e.keyword||e.date_from||e.date_to?p=await I.search(e):p=await I.findAll(e),p.success){const f=p.data||[],i=p.total||0;console.log("ğŸ“Š æ•°æ®åŠ è½½ç»“æœ:",{returned:f.length,total:i,currentPage:_.value,hasMore:_.value*O.value<i}),l?d.value=[...d.value,...f]:d.value=[...f];const D=d.value.length<i;return C.value=D,m.value=!D,f.length>0&&D&&_.value++,console.log("ğŸ“Š åˆ†é¡µä¿¡æ¯æ›´æ–°:",{hasMoreData:D,currentPage:_.value,recordsLength:d.value.length,totalCount:i}),v.value=!1,Promise.resolve()}else{const f=new Error(p.error||"æ•°æ®åŠ è½½å¤±è´¥");throw console.error("æ•°æ®åŠ è½½å¤±è´¥:",f),v.value=!1,m.value=!0,f}}catch(e){throw console.error("æ•°æ®åŠ è½½å¤±è´¥:",e),v.value=!1,m.value=!0,e}},ae=()=>{console.log("ğŸ”„ ä¸‹æ‹‰åˆ·æ–°å¼€å§‹...",{refreshing:E.value,finished:m.value,hasMore:C.value,currentPage:_.value}),m.value=!1,C.value=!0,_.value=1,console.log("ğŸ”„ åˆ·æ–°å‚æ•°è®¾ç½®å®Œæˆ:",{finished:m.value,hasMore:C.value,currentPage:_.value}),w(!1).finally(()=>{console.log("ğŸ”„ ä¸‹æ‹‰åˆ·æ–°å®Œæˆï¼Œè®¾ç½®refreshingä¸ºfalse"),E.value=!1})},le=()=>{console.log("ğŸ”„ åŠ è½½æ›´å¤šè§¦å‘..."),console.log("onLoadMore called:",{hasMore:C.value,loading:v.value,finished:m.value,currentPage:_.value,recordsLength:d.value.length}),C.value&&!v.value&&!m.value?(console.log("Loading more records..."),w(!0)):(m.value=!0,console.log("Cannot load more:",{hasMore:C.value,loading:v.value,finished:m.value}))},te=l=>{t.value={...l},L.value=!0},oe=async()=>{try{if(!t.value.person_name||!t.value.gender||!t.value.org_name){h("è¯·å¡«å†™å¿…è¦ä¿¡æ¯ï¼ˆå§“åã€æ€§åˆ«ã€å¹¼å„¿å›­ï¼‰");return}if(t.value.record_type==="CHILD"){if(!t.value.age){h("è¯·å¡«å†™å„¿ç«¥å¹´é¾„");return}}else if(t.value.record_type==="EMPLOYEE"&&!t.value.marital_status){h("è¯·é€‰æ‹©ä»ä¸šäººå‘˜å©šå§»çŠ¶å†µ");return}(await I.update(t.value.record_id,t.value)).success?(h({message:"æ›´æ–°æˆåŠŸ",type:"success",duration:1500}),L.value=!1,w()):h("æ›´æ–°å¤±è´¥")}catch(l){console.error("æ›´æ–°è®°å½•å¤±è´¥:",l),h("æ›´æ–°å¤±è´¥")}},ne=()=>{if(t.value?.age){const l=Number(t.value.age);l<3?t.value.age_category="3å²ä»¥ä¸‹":l<=6?t.value.age_category="3-6å²":t.value.age_category="6å²ä»¥ä¸Š"}},se=({selectedValues:l})=>{const e=l[0],p=P.value.find(f=>f.org_name===e);p?(t.value.org_name=e,t.value.org_id=p.org_id):t.value.org_name=e,U.value=!1},re=async()=>{try{console.log("ğŸ” å¼€å§‹åŠ è½½æœºæ„åˆ—è¡¨...");const l=await ye.findAll();l.success&&l.data?(P.value=l.data,console.log(`âœ… æˆåŠŸåŠ è½½ ${l.data.length} ä¸ªæœºæ„`),R.value=[...l.data.map(e=>({text:e.org_name,value:e.org_name,disabled:!1}))],console.log("ğŸ“‹ æœºæ„åˆ—è¡¨åŠ è½½å®Œæˆï¼Œcolumnså·²æ›´æ–°")):(console.error("âŒ æœºæ„åˆ—è¡¨åŠ è½½å¤±è´¥:",l.error),P.value=[],R.value=[])}catch(l){console.error("ğŸ’¥ åŠ è½½æœºæ„åˆ—è¡¨å¤±è´¥:",l),P.value=[],R.value=[]}},ue=async l=>{try{await Ce({title:"ç¡®è®¤åˆ é™¤",message:`ç¡®å®šè¦åˆ é™¤ ${l.person_name} çš„ä½“æ£€è®°å½•å—ï¼Ÿ`,confirmButtonText:"åˆ é™¤",cancelButtonText:"å–æ¶ˆ"}),(await I.delete(l.record_id)).success?(h({message:"åˆ é™¤æˆåŠŸ",type:"success",duration:1500}),w()):h("åˆ é™¤å¤±è´¥")}catch(e){console.error("åˆ é™¤è®°å½•å¤±è´¥:",e),e!=="cancel"&&h("åˆ é™¤å¤±è´¥")}},Y=()=>{console.log("ğŸ”„ é‡ç½®ç­›é€‰æ¡ä»¶"),r.value={recordType:"",startDate:"",endDate:"",keyword:""},console.log("âœ… é‡ç½®åçš„filters:",r.value),w()};return fe(()=>{w(),re()}),ge(()=>{x.value=!1,S.value=!1,L.value=!1,d.value=[],v.value=!1,E.value=!1,m.value=!1,_.value=1,r.value={recordType:"",dateRange:"",keyword:"",orgName:"",orgId:"",gender:""}}),(l,e)=>{const p=g("van-nav-bar"),f=g("van-search"),i=g("van-radio"),D=g("van-radio-group"),b=g("van-field"),T=g("van-button"),de=g("van-list"),ie=g("van-pull-refresh"),ve=g("van-empty"),B=g("van-date-picker"),z=g("van-popup"),N=g("van-picker"),me=g("van-dialog");return k(),V("div",ke,[o(p,{title:"æ•°æ®ç®¡ç†","left-arrow":"",onClickLeft:e[0]||(e[0]=a=>l.$router.back()),fixed:"",placeholder:""}),n("div",he,[n("div",De,[o(f,{modelValue:r.value.keyword,"onUpdate:modelValue":e[1]||(e[1]=a=>r.value.keyword=a),placeholder:"è¯·è¾“å…¥å§“åæˆ–å¹¼å„¿å›­åç§°",onSearch:w,onClear:w,shape:"round"},null,8,["modelValue"])]),n("div",Ve,[n("div",xe,[n("div",Se,[e[29]||(e[29]=n("div",{class:"record-type-label"},"ä½“æ£€ç±»å‹ï¼š",-1)),o(D,{modelValue:r.value.recordType,"onUpdate:modelValue":e[2]||(e[2]=a=>r.value.recordType=a),direction:"horizontal"},{default:s(()=>[o(i,{name:""},{default:s(()=>[...e[26]||(e[26]=[y("å…¨éƒ¨",-1)])]),_:1}),o(i,{name:"CHILD"},{default:s(()=>[...e[27]||(e[27]=[y("å„¿ç«¥",-1)])]),_:1}),o(i,{name:"EMPLOYEE"},{default:s(()=>[...e[28]||(e[28]=[y("ä»ä¸šäººå‘˜",-1)])]),_:1})]),_:1},8,["modelValue"])])]),n("div",Le,[o(b,{"model-value":r.value.startDate,label:"å¼€å§‹æ—¥æœŸ",placeholder:"é€‰æ‹©å¼€å§‹æ—¥æœŸ","is-link":"",readonly:"",onClick:e[3]||(e[3]=a=>x.value=!0)},null,8,["model-value"]),o(b,{"model-value":r.value.endDate,label:"ç»“æŸæ—¥æœŸ",placeholder:"é€‰æ‹©ç»“æŸæ—¥æœŸ","is-link":"",readonly:"",onClick:e[4]||(e[4]=a=>S.value=!0)},null,8,["model-value"])])]),n("div",Me,[o(T,{type:"primary",onClick:ee,loading:v.value},{default:s(()=>[...e[30]||(e[30]=[y(" æœç´¢ ",-1)])]),_:1},8,["loading"]),o(T,{onClick:Y},{default:s(()=>[...e[31]||(e[31]=[y(" é‡ç½® ",-1)])]),_:1})])]),d.value.length>0?(k(),V("div",Ee,[n("div",Ue,[e[32]||(e[32]=n("span",{class:"stat-label"},"æ€»è®°å½•æ•°ï¼š",-1)),n("span",Te,c(j.value),1)]),n("div",$e,[e[33]||(e[33]=n("span",{class:"stat-label"},"å„¿ç«¥ä½“æ£€ï¼š",-1)),n("span",Pe,c(G.value),1)]),n("div",Re,[e[34]||(e[34]=n("span",{class:"stat-label"},"ä»ä¸šäººå‘˜ä½“æ£€ï¼š",-1)),n("span",ze,c(J.value),1)])])):M("",!0),n("div",Ie,[o(ie,{modelValue:E.value,"onUpdate:modelValue":e[6]||(e[6]=a=>E.value=a),onRefresh:ae,"success-text":"åˆ·æ–°æˆåŠŸ"},{default:s(()=>[o(de,{loading:v.value,"onUpdate:loading":e[5]||(e[5]=a=>v.value=a),finished:m.value,offset:100,"immediate-check":!0,"page-size":O.value,"finished-text":"æ²¡æœ‰æ›´å¤šæ•°æ®äº†",onLoad:le},{default:s(()=>[(k(!0),V(q,null,we(d.value,a=>(k(),V("div",{key:a.record_id,class:"record-card"},[n("div",Oe,[n("div",{class:be(["record-type-badge",a.record_type.toLowerCase()])},c(Q(a.record_type)),3),n("div",Ae,c(K(a.examination_date)),1)]),n("div",qe,[n("div",He,[e[35]||(e[35]=n("span",{class:"label"},"å§“åï¼š",-1)),n("span",Ye,c(a.person_name)+" - "+c(a.gender)+" - "+c(a.record_type==="CHILD"?a.age_category:a.record_type==="EMPLOYEE"?a.marital_status:""),1)]),n("div",Be,[e[36]||(e[36]=n("span",{class:"label"},"æœºæ„ï¼š",-1)),n("span",Ne,c(a.org_name),1)])]),n("div",Fe,[o(T,{type:"primary",size:"small",icon:"edit",onClick:ce=>te(a),class:"action-button edit-btn"},{default:s(()=>[...e[37]||(e[37]=[y(" ç¼–è¾‘ ",-1)])]),_:1},8,["onClick"]),o(T,{type:"danger",size:"small",icon:"delete",onClick:ce=>ue(a),class:"action-button delete-btn"},{default:s(()=>[...e[38]||(e[38]=[y(" åˆ é™¤ ",-1)])]),_:1},8,["onClick"])])]))),128))]),_:1},8,["loading","finished","page-size"])]),_:1},8,["modelValue"])]),d.value.length>0?(k(),V("div",je,[n("div",null,"å½“å‰è®°å½•æ•°ï¼š"+c(d.value.length),1),n("div",null,"åŠ è½½ä¸­ï¼š"+c(v.value),1),n("div",null,"å·²å®Œæˆï¼š"+c(m.value),1),n("div",null,"è¿˜æœ‰æ›´å¤šï¼š"+c(C.value),1),n("div",null,"å½“å‰é¡µï¼š"+c(_.value),1)])):M("",!0),d.value.length===0&&!v.value?(k(),_e(ve,{key:2,description:"æš‚æ— ä½“æ£€è®°å½•",image:"https://fastly.jsdelivr.net/npm/@vant/assets/custom-empty-image.png"},{default:s(()=>[o(T,{type:"primary",onClick:Y},{default:s(()=>[...e[39]||(e[39]=[y("æ¸…é™¤ç­›é€‰æ¡ä»¶",-1)])]),_:1})]),_:1})):M("",!0),o(z,{show:x.value,"onUpdate:show":e[8]||(e[8]=a=>x.value=a),position:"bottom"},{default:s(()=>[o(B,{title:"é€‰æ‹©å¼€å§‹æ—¥æœŸ","model-value":H(r.value.startDate),onConfirm:W,onCancel:e[7]||(e[7]=a=>x.value=!1),"min-date":new Date(2020,0,1),"max-date":new Date},null,8,["model-value","min-date","max-date"])]),_:1},8,["show"]),o(z,{show:S.value,"onUpdate:show":e[10]||(e[10]=a=>S.value=a),position:"bottom"},{default:s(()=>[o(B,{title:"é€‰æ‹©ç»“æŸæ—¥æœŸ","model-value":H(r.value.endDate),onConfirm:X,onCancel:e[9]||(e[9]=a=>S.value=!1),"min-date":new Date(2020,0,1),"max-date":new Date},null,8,["model-value","min-date","max-date"])]),_:1},8,["show"]),o(z,{show:$.value,"onUpdate:show":e[12]||(e[12]=a=>$.value=a),position:"bottom"},{default:s(()=>[o(N,{columns:F.value,title:"é€‰æ‹©å©šå§»çŠ¶å†µ",onConfirm:Z,onCancel:e[11]||(e[11]=a=>$.value=!1)},null,8,["columns"])]),_:1},8,["show"]),o(me,{show:L.value,"onUpdate:show":e[22]||(e[22]=a=>L.value=a),title:`ç¼–è¾‘${t.value?.record_type==="CHILD"?"å„¿ç«¥":"ä»ä¸šäººå‘˜"}ä½“æ£€è®°å½•`,"show-cancel-button":"",onConfirm:oe,onCancel:e[23]||(e[23]=a=>L.value=!1),width:"90%","confirm-button-text":"ä¿å­˜","cancel-button-text":"å–æ¶ˆ"},{default:s(()=>[t.value?(k(),V("div",Ge,[o(b,{"model-value":t.value.examination_date,label:"ä½“æ£€æ—¥æœŸ",readonly:"",placeholder:"ä½“æ£€æ—¥æœŸï¼š"+t.value.examination_date,required:!0},{label:s(()=>[...e[40]||(e[40]=[n("span",{class:"readonly-label"},"ä½“æ£€æ—¥æœŸ",-1)])]),_:1},8,["model-value","placeholder"]),o(b,{modelValue:t.value.org_name,"onUpdate:modelValue":e[13]||(e[13]=a=>t.value.org_name=a),label:"å¹¼å„¿å›­",placeholder:"è¯·é€‰æ‹©å¹¼å„¿å›­",required:"",readonly:"","is-link":"",onClick:e[14]||(e[14]=a=>U.value=!0)},null,8,["modelValue"]),o(b,{modelValue:t.value.person_name,"onUpdate:modelValue":e[15]||(e[15]=a=>t.value.person_name=a),label:"ä½“æ£€äººå‘˜å§“å",placeholder:"è¯·è¾“å…¥ä½“æ£€äººå‘˜å§“å",required:"",maxlength:"10","label-width":"100px"},null,8,["modelValue"]),o(b,{label:"æ€§åˆ«",required:""},{input:s(()=>[o(D,{modelValue:t.value.gender,"onUpdate:modelValue":e[16]||(e[16]=a=>t.value.gender=a),direction:"horizontal"},{default:s(()=>[o(i,{name:"å¥³"},{default:s(()=>[...e[41]||(e[41]=[y("å¥³",-1)])]),_:1}),o(i,{name:"ç”·"},{default:s(()=>[...e[42]||(e[42]=[y("ç”·",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t.value.record_type==="CHILD"?(k(),V(q,{key:0},[o(b,{modelValue:t.value.serial_number,"onUpdate:modelValue":e[17]||(e[17]=a=>t.value.serial_number=a),label:"åºå·",placeholder:"1-20",type:"number",maxlength:"2"},null,8,["modelValue"]),o(b,{modelValue:t.value.age,"onUpdate:modelValue":e[18]||(e[18]=a=>t.value.age=a),modelModifiers:{number:!0},label:"å¹´é¾„",type:"number",placeholder:"è¯·è¾“å…¥å¹´é¾„",required:"",maxlength:"2",onInput:ne},null,8,["modelValue"]),o(b,{modelValue:t.value.age_category,"onUpdate:modelValue":e[19]||(e[19]=a=>t.value.age_category=a),label:"å¹´é¾„åˆ†ç±»",readonly:"",placeholder:"æ ¹æ®å¹´é¾„è‡ªåŠ¨è®¡ç®—"},null,8,["modelValue"])],64)):M("",!0),t.value.record_type==="EMPLOYEE"?(k(),V(q,{key:1},[o(b,{label:"å©šå§»çŠ¶å†µ",required:""},{input:s(()=>[o(D,{modelValue:t.value.marital_status,"onUpdate:modelValue":e[20]||(e[20]=a=>t.value.marital_status=a),direction:"horizontal"},{default:s(()=>[o(i,{name:"æœªå©š"},{default:s(()=>[...e[43]||(e[43]=[y("æœªå©š",-1)])]),_:1}),o(i,{name:"å·²å©š"},{default:s(()=>[...e[44]||(e[44]=[y("å·²å©š",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(b,{modelValue:t.value.remarks,"onUpdate:modelValue":e[21]||(e[21]=a=>t.value.remarks=a),label:"å¤‡æ³¨",type:"textarea",placeholder:"è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯",rows:"3",maxlength:"200","show-word-limit":""},null,8,["modelValue"])],64)):M("",!0)])):M("",!0)]),_:1},8,["show","title"]),o(z,{show:U.value,"onUpdate:show":e[25]||(e[25]=a=>U.value=a),position:"bottom"},{default:s(()=>[o(N,{columns:R.value,title:"é€‰æ‹©å¹¼å„¿å›­",onConfirm:se,onCancel:e[24]||(e[24]=a=>U.value=!1)},null,8,["columns"])]),_:1},8,["show"])])}}},Ze=pe(Je,[["__scopeId","data-v-2f5db0c2"]]);export{Ze as default};
