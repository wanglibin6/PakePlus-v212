import{_ as M,g as i,h as j,i as A,o as F,c as P,a as n,b as g,r as s,w as u,j as E,u as H,e as Y,f as x,k,s as c,l as G}from"./index-AjeEuBR7.js";import{s as J}from"./function-call-ElmC6OtN.js";const K={class:"child-register-page"},Q={class:"content"},W={class:"form-section"},X={class:"form-section"},Z={class:"action-bar"},ee={__name:"ChildRegister",setup(ae){const I=H(),a=i({examination_date:"",org_name:"",org_id:"",serial_number:"",person_name:"",gender:"",age:"",age_category:""}),d=i(!1),m=i(!1),p=i(!1),f=i(["2024","01","01"]),U=new Date(2020,0,1),$=new Date,_=i([]),v=i([]),y=j(()=>a.value.examination_date&&a.value.org_name&&a.value.org_id&&a.value.person_name&&a.value.gender&&a.value.age),S=()=>{if(!a.value.org_name)return 0;const o=v.value.findIndex(e=>e.value===a.value.org_name);return o>=0?o:0},O=async()=>{try{console.log("ğŸ” å¼€å§‹åŠ è½½æœºæ„åˆ—è¡¨...");const o=await E.findAll();o.success&&o.data?(_.value=o.data,console.log(`âœ… æˆåŠŸåŠ è½½ ${o.data.length} ä¸ªæœºæ„`),v.value=[...o.data.map(e=>({text:e.org_name,value:e.org_name,disabled:!1}))],console.log("ğŸ“‹ æœºæ„åˆ—è¡¨åŠ è½½å®Œæˆï¼Œcolumnså·²æ›´æ–°")):(console.error("âŒ æœºæ„åˆ—è¡¨åŠ è½½å¤±è´¥:",o.error),_.value=[],v.value=[])}catch(o){console.error("ğŸ’¥ åŠ è½½æœºæ„åˆ—è¡¨å¤±è´¥:",o),_.value=[],v.value=[]}},q=({selectedValues:o})=>{a.value.examination_date=o.join("-"),d.value=!1},B=({selectedValues:o})=>{const e=o[0],t=_.value.find(r=>r.org_name===e);console.log("ğŸ” é€‰æ‹©çš„æœºæ„:",t),t?(a.value.org_name=e,a.value.org_id=t.org_id,console.log("âœ… æœºæ„é€‰æ‹©ç¡®è®¤:",e,"ID:",t.org_id)):(a.value.org_name=e,console.warn("âš ï¸ æœªæ‰¾åˆ°æœºæ„çš„ID:",e)),m.value=!1},z=()=>{a.value.age?parseInt(a.value.age)>=4?a.value.age_category="å››å²ä»¥ä¸Š":a.value.age_category="å››å²ä»¥ä¸‹":a.value.age_category=""},b=()=>{const o=new Date,e=o.getFullYear(),t=String(o.getMonth()+1).padStart(2,"0"),r=String(o.getDate()).padStart(2,"0");a.value.examination_date=`${e}-${t}-${r}`,f.value=[e.toString(),t,r]},V=async()=>{try{if(!y.value){c("è¯·å¡«å†™å®Œæ•´ä¿¡æ¯");return}if(a.value.age&&(a.value.age<1||a.value.age>18)){c("è¯·è¾“å…¥æœ‰æ•ˆçš„å¹´é¾„ï¼ˆ1-18å²ï¼‰");return}if(a.value.serial_number){const t=parseInt(a.value.serial_number);if(t<1||t>20){c("åºå·å¿…é¡»åœ¨1-20ä¹‹é—´");return}}p.value=!0;const o={record_type:"CHILD",serial_number:a.value.serial_number?parseInt(a.value.serial_number):null,examination_date:a.value.examination_date,org_id:a.value.org_id,org_name:a.value.org_name,person_name:a.value.person_name,gender:a.value.gender,age:parseInt(a.value.age)||null,age_category:a.value.age_category||null};console.log("ğŸ” ä¿å­˜å‰æ•°æ®æ£€æŸ¥:",{å¹´é¾„è¾“å…¥å€¼:a.value.age,å¹´é¾„åˆ†ç±»:a.value.age_category,å¤„ç†åå¹´é¾„:o.age,å¤„ç†ååˆ†ç±»:o.age_category});const e=await G.create(o);if(e.success){c({message:`ä¿å­˜æˆåŠŸï¼åºå·ï¼š${e.serialNumber}`,type:"success",duration:1500});try{await J({title:"ä¿å­˜æˆåŠŸ",message:"æ˜¯å¦ç»§ç»­æ·»åŠ æ–°çš„å„¿ç«¥ä½“æ£€è®°å½•ï¼Ÿ",confirmButtonText:"ç»§ç»­æ·»åŠ ",cancelButtonText:"è¿”å›é¦–é¡µ"}),w(),b()}catch(t){t==="confirm"?(w(),b()):I.push("/")}}else c(e.error||"ä¿å­˜å¤±è´¥")}catch(o){console.error("ä¿å­˜å¤±è´¥:",o),c("ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{p.value=!1}},w=()=>{a.value={examination_date:"",org_name:"",org_id:"",serial_number:"",person_name:"",gender:"å¥³",age:"",age_category:""}};return A(()=>{O(),b()}),F(()=>{d.value=!1,m.value=!1,p.value=!1,_.value=[],v.value=[]}),(o,e)=>{const t=s("van-nav-bar"),r=s("van-field"),C=s("van-radio"),N=s("van-radio-group"),R=s("van-form"),T=s("van-button"),h=s("van-date-picker"),D=s("van-popup"),L=s("van-picker");return Y(),P("div",K,[n(t,{title:"å„¿ç«¥ä½“æ£€ç™»è®°","left-arrow":"",onClickLeft:e[0]||(e[0]=l=>o.$router.back()),fixed:"",placeholder:""}),g("div",Q,[n(R,{onSubmit:V,"label-width":"100px"},{default:u(()=>[g("div",W,[e[15]||(e[15]=g("h3",{class:"section-title"},"åŸºæœ¬ä¿¡æ¯",-1)),n(r,{modelValue:a.value.examination_date,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.examination_date=l),label:"ä½“æ£€æ—¥æœŸ",placeholder:"è¯·é€‰æ‹©ä½“æ£€æ—¥æœŸ",readonly:"","is-link":"",required:"",onClick:e[2]||(e[2]=l=>d.value=!0)},null,8,["modelValue"]),n(r,{modelValue:a.value.org_name,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.org_name=l),label:"å¹¼å„¿å›­",placeholder:"è¯·é€‰æ‹©å¹¼å„¿å›­",required:"","is-link":"",readonly:"",onClick:e[4]||(e[4]=l=>m.value=!0)},null,8,["modelValue"])]),g("div",X,[e[18]||(e[18]=g("h3",{class:"section-title"},"å„¿ç«¥ä¿¡æ¯",-1)),n(r,{modelValue:a.value.serial_number,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.serial_number=l),label:"åºå·",placeholder:"1-20",type:"number",maxlength:"2"},null,8,["modelValue"]),n(r,{modelValue:a.value.person_name,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.person_name=l),label:"ä½“æ£€äººå‘˜å§“å",placeholder:"è¯·è¾“å…¥ä½“æ£€äººå‘˜å§“å",required:"",maxlength:"10"},null,8,["modelValue"]),n(r,{label:"æ€§åˆ«",required:""},{input:u(()=>[n(N,{modelValue:a.value.gender,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.gender=l),direction:"horizontal"},{default:u(()=>[n(C,{name:"å¥³"},{default:u(()=>[...e[16]||(e[16]=[x("å¥³",-1)])]),_:1}),n(C,{name:"ç”·"},{default:u(()=>[...e[17]||(e[17]=[x("ç”·",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),n(r,{modelValue:a.value.age,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.age=l),modelModifiers:{number:!0},label:"å¹´é¾„",placeholder:"è¯·è¾“å…¥å¹´é¾„",type:"number",required:"",maxlength:"2",onInput:z},null,8,["modelValue"]),n(r,{modelValue:a.value.age_category,"onUpdate:modelValue":e[9]||(e[9]=l=>a.value.age_category=l),label:"å¹´é¾„åˆ†ç±»",readonly:"",placeholder:"æ ¹æ®å¹´é¾„è‡ªåŠ¨è®¡ç®—"},null,8,["modelValue"])])]),_:1})]),g("div",Z,[n(T,{type:"primary",size:"large",block:"",onClick:V,loading:p.value,disabled:!y.value},{default:u(()=>[...e[19]||(e[19]=[x(" ä¿å­˜ ",-1)])]),_:1},8,["loading","disabled"])]),n(D,{show:d.value,"onUpdate:show":e[12]||(e[12]=l=>d.value=l),position:"bottom"},{default:u(()=>[n(h,{modelValue:f.value,"onUpdate:modelValue":e[10]||(e[10]=l=>f.value=l),title:"é€‰æ‹©ä½“æ£€æ—¥æœŸ",onConfirm:q,onCancel:e[11]||(e[11]=l=>d.value=!1),"min-date":k(U),"max-date":k($)},null,8,["modelValue","min-date","max-date"])]),_:1},8,["show"]),n(D,{show:m.value,"onUpdate:show":e[14]||(e[14]=l=>m.value=l),position:"bottom"},{default:u(()=>[n(L,{columns:v.value,"default-index":S(),title:"é€‰æ‹©æ‰˜å¹¼æœºæ„",onConfirm:B,onCancel:e[13]||(e[13]=l=>m.value=!1)},null,8,["columns","default-index"])]),_:1},8,["show"])])}}},ne=M(ee,[["__scopeId","data-v-953e17d6"]]);export{ne as default};
