import{_ as L,g as i,h as M,i as N,o as P,c as j,a as n,b as v,r as u,w as l,j as W,u as Y,e as A,f as g,k as C,l as G,s as k}from"./index-AjeEuBR7.js";import{s as H}from"./function-call-ElmC6OtN.js";const J={class:"worker-register-page"},K={class:"content"},Q={class:"form-section"},X={class:"form-section"},Z={class:"action-bar"},h={__name:"WorkerRegister",setup(ee){const S=Y(),a=i({examination_date:"",org_name:"",org_id:"",person_name:"",gender:"å¥³",marital_status:"",remarks:""}),d=i(!1),m=i(!1),f=i(!1),w=i(["2024","01","01"]),U=new Date(2020,0,1),$=new Date,p=i([]),_=i([]),x=M(()=>a.value.examination_date&&a.value.org_name&&a.value.org_id&&a.value.person_name&&a.value.gender&&a.value.marital_status),O=async()=>{try{console.log("ðŸ” å¼€å§‹åŠ è½½æœºæž„åˆ—è¡¨...");const o=await W.findAll();o.success&&o.data?(p.value=o.data,console.log(`âœ… æˆåŠŸåŠ è½½ ${o.data.length} ä¸ªæœºæž„`),_.value=[...o.data.map(e=>({text:e.org_name,value:e.org_name,disabled:!1}))],console.log("ðŸ“‹ æœºæž„åˆ—è¡¨åŠ è½½å®Œæˆï¼Œcolumnså·²æ›´æ–°")):(console.error("âŒ æœºæž„åˆ—è¡¨åŠ è½½å¤±è´¥:",o.error),p.value=[],_.value=[])}catch(o){console.error("ðŸ’¥ åŠ è½½æœºæž„åˆ—è¡¨å¤±è´¥:",o),p.value=[],_.value=[]}},q=({selectedValues:o})=>{a.value.examination_date=o.join("-"),d.value=!1},z=({selectedValues:o})=>{const e=o[0],s=p.value.find(r=>r.org_name===e);console.log("ðŸ” é€‰æ‹©çš„æœºæž„:",s),s?(a.value.org_name=e,a.value.org_id=s.org_id,console.log("âœ… æœºæž„é€‰æ‹©ç¡®è®¤:",e,"ID:",s.org_id)):(a.value.org_name=e,console.warn("âš ï¸ æœªæ‰¾åˆ°æœºæž„çš„ID:",e)),m.value=!1},B=()=>x.value?!0:(k("è¯·å¡«å†™å®Œæ•´ä¿¡æ¯"),!1),V=async()=>{try{if(!B())return;f.value=!0;const o={record_type:"EMPLOYEE",examination_date:a.value.examination_date,org_id:a.value.org_id,org_name:a.value.org_name,person_name:a.value.person_name,gender:a.value.gender,marital_status:a.value.marital_status,remarks:a.value.remarks},e=await G.create(o);if(e.success){k({message:"ä¿å­˜æˆåŠŸï¼",type:"success",duration:1500});try{await H({title:"ä¿å­˜æˆåŠŸ",message:"æ˜¯å¦ç»§ç»­æ·»åŠ æ–°çš„ä»Žä¸šäººå‘˜ä½“æ£€è®°å½•ï¼Ÿ",confirmButtonText:"ç»§ç»­æ·»åŠ ",cancelButtonText:"è¿”å›žé¦–é¡µ"}),E(),b()}catch{S.push("/")}}else k(e.error||"ä¿å­˜å¤±è´¥")}catch(o){console.error("ä¿å­˜å¤±è´¥:",o),k("ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{f.value=!1}},E=()=>{a.value={examination_date:"",org_id:"",org_name:"",person_name:"",gender:"å¥³",marital_status:"",remarks:""}},b=()=>{const o=new Date,e=o.getFullYear(),s=String(o.getMonth()+1).padStart(2,"0"),r=String(o.getDate()).padStart(2,"0");a.value.examination_date=`${e}-${s}-${r}`,w.value=[e.toString(),s,r]};return N(()=>{O(),b()}),P(()=>{d.value=!1,m.value=!1,f.value=!1,p.value=[],_.value=[]}),(o,e)=>{const s=u("van-nav-bar"),r=u("van-field"),c=u("van-radio"),y=u("van-radio-group"),R=u("van-form"),T=u("van-button"),F=u("van-date-picker"),D=u("van-popup"),I=u("van-picker");return A(),j("div",J,[n(s,{title:"ä»Žä¸šäººå‘˜ä½“æ£€ç™»è®°","left-arrow":"",onClickLeft:e[0]||(e[0]=t=>o.$router.back()),fixed:"",placeholder:""}),v("div",K,[n(R,{onSubmit:V,"label-width":"100px"},{default:l(()=>[v("div",Q,[e[14]||(e[14]=v("h3",{class:"section-title"},"åŸºæœ¬ä¿¡æ¯",-1)),n(r,{modelValue:a.value.examination_date,"onUpdate:modelValue":e[1]||(e[1]=t=>a.value.examination_date=t),label:"ä½“æ£€æ—¥æœŸ",placeholder:"è¯·é€‰æ‹©ä½“æ£€æ—¥æœŸ",readonly:"","is-link":"",required:"",onClick:e[2]||(e[2]=t=>d.value=!0)},null,8,["modelValue"]),n(r,{modelValue:a.value.org_name,"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.org_name=t),label:"å¹¼å„¿å›­",placeholder:"è¯·é€‰æ‹©å¹¼å„¿å›­",required:"","is-link":"",readonly:"",onClick:e[4]||(e[4]=t=>m.value=!0)},null,8,["modelValue"])]),v("div",X,[e[19]||(e[19]=v("h3",{class:"section-title"},"ä¸ªäººä¿¡æ¯",-1)),n(r,{modelValue:a.value.person_name,"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.person_name=t),label:"ä½“æ£€äººå‘˜å§“å",maxlength:"10",placeholder:"è¯·è¾“å…¥ä½“æ£€äººå‘˜å§“å",required:""},null,8,["modelValue"]),n(r,{label:"æ€§åˆ«",required:""},{input:l(()=>[n(y,{modelValue:a.value.gender,"onUpdate:modelValue":e[6]||(e[6]=t=>a.value.gender=t),direction:"horizontal"},{default:l(()=>[n(c,{name:"å¥³"},{default:l(()=>[...e[15]||(e[15]=[g("å¥³",-1)])]),_:1}),n(c,{name:"ç”·"},{default:l(()=>[...e[16]||(e[16]=[g("ç”·",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),n(r,{label:"å©šå§»çŠ¶å†µ",required:""},{input:l(()=>[n(y,{modelValue:a.value.marital_status,"onUpdate:modelValue":e[7]||(e[7]=t=>a.value.marital_status=t),direction:"horizontal"},{default:l(()=>[n(c,{name:"æœªå©š"},{default:l(()=>[...e[17]||(e[17]=[g("æœªå©š",-1)])]),_:1}),n(c,{name:"å·²å©š"},{default:l(()=>[...e[18]||(e[18]=[g("å·²å©š",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),n(r,{modelValue:a.value.remarks,"onUpdate:modelValue":e[8]||(e[8]=t=>a.value.remarks=t),label:"å¤‡æ³¨",type:"textarea",placeholder:"è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯ï¼ˆé€‰å¡«ï¼‰",rows:"3",maxlength:"200","show-word-limit":""},null,8,["modelValue"])])]),_:1})]),v("div",Z,[n(T,{type:"primary",size:"large",block:"",onClick:V,loading:f.value,disabled:!x.value},{default:l(()=>[...e[20]||(e[20]=[g(" ä¿å­˜ ",-1)])]),_:1},8,["loading","disabled"])]),n(D,{show:d.value,"onUpdate:show":e[11]||(e[11]=t=>d.value=t),position:"bottom"},{default:l(()=>[n(F,{modelValue:w.value,"onUpdate:modelValue":e[9]||(e[9]=t=>w.value=t),title:"é€‰æ‹©ä½“æ£€æ—¥æœŸ",onConfirm:q,onCancel:e[10]||(e[10]=t=>d.value=!1),"min-date":C(U),"max-date":C($)},null,8,["modelValue","min-date","max-date"])]),_:1},8,["show"]),n(D,{show:m.value,"onUpdate:show":e[13]||(e[13]=t=>m.value=t),position:"bottom"},{default:l(()=>[n(I,{columns:_.value,title:"é€‰æ‹©å¹¼å„¿å›­",onConfirm:z,onCancel:e[12]||(e[12]=t=>m.value=!1)},null,8,["columns"])]),_:1},8,["show"])])}}},te=L(h,[["__scopeId","data-v-88f826ed"]]);export{te as default};
