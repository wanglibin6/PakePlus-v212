import{_ as P,g as o,h as W,i as Y,o as G,v as J,c as h,a as l,b as t,m as b,n as Q,w as m,r as c,t as i,j as D,l as X,s as r,e as p,f as E,F as Z,p as ee}from"./index-AjeEuBR7.js";import{a as te}from"./function-call-ElmC6OtN.js";const se={class:"org-management-page"},ae={class:"search-section"},oe={key:0,class:"stats-section"},le={class:"stats-item"},ne={class:"stats-value"},ie={class:"org-list-section"},re={class:"org-header"},de={class:"org-name"},ue={class:"org-actions"},ce={class:"org-info"},ve={class:"info-item"},_e={class:"value"},me={key:0,class:"org-stats"},pe={class:"stat-item"},ge={class:"stat-value"},fe={class:"edit-form"},he={key:0,class:"detail-content"},we={class:"detail-section"},ye={class:"detail-item"},Ce={class:"value"},Se={class:"detail-item"},be={class:"value"},ke={class:"detail-item"},Oe={class:"value"},$e={key:0,class:"detail-item"},De={class:"value"},Ve={class:"detail-section"},Te={class:"detail-item"},xe={class:"value"},ze={class:"detail-item"},Be={class:"value"},Ue={__name:"OrgManagement",setup(Ee){const v=o([]),w=o(!1),k=o(!1),V=o(!0),y=o(""),_=o(!1),T=o(!1),C=o(!1),x=o(null),n=o(null),g=o({org_name:""}),M=W(()=>y.value?v.value.filter(s=>s.org_name.toLowerCase().includes(y.value.toLowerCase())):v.value),z=s=>{if(!s)return"æœªçŸ¥";const e=new Date(s);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`},f=async()=>{console.log("ğŸ“‹ loadOrganizations å‡½æ•°è¢«è°ƒç”¨");try{w.value=!0,console.log("â³ å¼€å§‹åŠ è½½æœºæ„åˆ—è¡¨...");const s=await D.findAll();if(s.success){const e=s.data||[],O=await Promise.all(e.map(async d=>{try{const u=await X.search({org_id:d.org_id}),$=u.success?(u.data||[]).length:0;return{...d,recordsCount:$}}catch(u){return console.warn(`è·å–æœºæ„ ${d.org_name} çš„ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:`,u),{...d,recordsCount:0}}}));v.value=O.sort((d,u)=>new Date(u.updated_at||u.created_at)-new Date(d.updated_at||d.created_at)),V.value=!0,console.log(`æˆåŠŸåŠ è½½ ${v.value.length} ä¸ªæœºæ„`)}else r("åŠ è½½æœºæ„åˆ—è¡¨å¤±è´¥"),console.error("æ•°æ®åº“æŸ¥è¯¢å¤±è´¥:",s.error)}catch(s){console.error("åŠ è½½æœºæ„åˆ—è¡¨å¤±è´¥:",s),r("åŠ è½½æœºæ„åˆ—è¡¨å¤±è´¥")}finally{w.value=!1,k.value=!1}},F=()=>{f()},I=s=>{C.value=!0,x.value=s.org_id,g.value={org_name:s.org_name},_.value=!0},L=s=>{te({title:"ç¡®è®¤åˆ é™¤",message:`ç¡®å®šè¦åˆ é™¤æœºæ„ "${s.org_name}" å—ï¼Ÿ
æ³¨æ„ï¼šåˆ é™¤åæ— æ³•æ¢å¤ã€‚`,showCancelButton:!0,confirmButtonText:"åˆ é™¤",cancelButtonText:"å–æ¶ˆ",confirmButtonColor:"#ff4d4f"}).then(async()=>{try{(await D.delete(s.org_id)).success?(r({message:"åˆ é™¤æˆåŠŸ",type:"success",duration:1500}),f()):r("åˆ é™¤å¤±è´¥")}catch(e){console.error("åˆ é™¤æœºæ„å¤±è´¥:",e),r("åˆ é™¤å¤±è´¥")}}).catch(()=>{r("å·²å–æ¶ˆåˆ é™¤")})},N=async()=>{try{if(!g.value.org_name.trim()){r("è¯·è¾“å…¥æœºæ„åç§°");return}let s;const e=C.value;e?s=await D.update(x.value,{...g.value,updated_at:new Date().toISOString()}):s=await D.create({...g.value,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),s.success?(r({message:e?"æ›´æ–°æˆåŠŸ":"æ·»åŠ æˆåŠŸ",type:"success",duration:1500}),_.value=!1,B(),console.log("ğŸ”„ å‡†å¤‡åˆ·æ–°æœºæ„åˆ—è¡¨ï¼Œå»¶è¿Ÿ100ms..."),setTimeout(()=>{console.log("ğŸš€ å¼€å§‹åˆ·æ–°æœºæ„åˆ—è¡¨..."),f()},100)):r(s.error||(e?"æ›´æ–°å¤±è´¥":"æ·»åŠ å¤±è´¥"))}catch(s){console.error("ä¿å­˜æœºæ„å¤±è´¥:",s),r("ä¿å­˜å¤±è´¥")}},R=()=>{_.value=!1,B()},B=()=>{C.value=!1,x.value=null,g.value={org_name:""}};Y(()=>{f()}),G(()=>{S&&(clearTimeout(S),S=null),v.value=[],w.value=!1,k.value=!1,V.value=!1,y.value="",_.value=!1,T.value=!1,C.value=!1,n.value=null}),J(()=>y.value,()=>{clearTimeout(S),S=setTimeout(()=>{},300)});let S;return(s,e)=>{const O=c("van-button"),d=c("van-nav-bar"),u=c("van-search"),$=c("van-icon"),A=c("van-list"),j=c("van-pull-refresh"),q=c("van-empty"),H=c("van-field"),U=c("van-dialog");return p(),h("div",se,[l(d,{title:"å¸¸ç”¨æœºæ„ç®¡ç†","left-arrow":"",onClickLeft:e[1]||(e[1]=a=>s.$router.back()),fixed:"",placeholder:""},{right:m(()=>[l(O,{type:"primary",size:"small",onClick:e[0]||(e[0]=a=>_.value=!0)},{default:m(()=>[...e[9]||(e[9]=[E(" æ·»åŠ æœºæ„ ",-1)])]),_:1})]),_:1}),t("div",ae,[l(u,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=a=>y.value=a),placeholder:"æœç´¢æœºæ„åç§°",onSearch:f,onClear:f,shape:"round"},null,8,["modelValue"])]),v.value.length>0?(p(),h("div",oe,[t("div",le,[e[10]||(e[10]=t("span",{class:"stats-label"},"æœºæ„æ€»æ•°ï¼š",-1)),t("span",ne,i(v.value.length),1)])])):b("",!0),t("div",ie,[l(j,{modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=a=>k.value=a),onRefresh:F},{default:m(()=>[l(A,{loading:w.value,"onUpdate:loading":e[3]||(e[3]=a=>w.value=a),finished:V.value,"finished-text":"æ²¡æœ‰æ›´å¤šæœºæ„äº†",onLoad:f},{default:m(()=>[(p(!0),h(Z,null,ee(M.value,a=>(p(),h("div",{key:a.org_id,class:"org-card"},[t("div",re,[t("div",de,i(a.org_name),1),t("div",ue,[l($,{name:"edit",size:"16",color:"#1989fa",onClick:K=>I(a)},null,8,["onClick"]),l($,{name:"delete",size:"16",color:"#ff4d4f",onClick:K=>L(a)},null,8,["onClick"])])]),t("div",ce,[t("div",ve,[e[11]||(e[11]=t("span",{class:"label"},"åˆ›å»ºæ—¶é—´ï¼š",-1)),t("span",_e,i(z(a.created_at||a.update_time)),1)])]),a.recordsCount?(p(),h("div",me,[t("div",pe,[e[12]||(e[12]=t("span",{class:"stat-label"},"ä½“æ£€è®°å½•æ•°",-1)),t("span",ge,i(a.recordsCount),1)])])):b("",!0)]))),128))]),_:1},8,["loading","finished"])]),_:1},8,["modelValue"])]),v.value.length===0&&!w.value?(p(),Q(q,{key:1,description:"æš‚æ— å¸¸ç”¨æœºæ„",image:"https://fastly.jsdelivr.net/npm/@vant/assets/custom-empty-image.png"},{default:m(()=>[l(O,{type:"primary",onClick:e[5]||(e[5]=a=>_.value=!0)},{default:m(()=>[...e[13]||(e[13]=[E("æ·»åŠ æœºæ„",-1)])]),_:1})]),_:1})):b("",!0),l(U,{show:_.value,"onUpdate:show":e[7]||(e[7]=a=>_.value=a),title:C.value?"ç¼–è¾‘æœºæ„":"æ·»åŠ æœºæ„","show-cancel-button":"",onConfirm:N,onCancel:R,width:"90%"},{default:m(()=>[t("div",fe,[l(H,{modelValue:g.value.org_name,"onUpdate:modelValue":e[6]||(e[6]=a=>g.value.org_name=a),label:"æœºæ„åç§°",placeholder:"è¯·è¾“å…¥æœºæ„åç§°",required:""},null,8,["modelValue"])])]),_:1},8,["show","title"]),l(U,{show:T.value,"onUpdate:show":e[8]||(e[8]=a=>T.value=a),title:n.value?.org_name,width:"90%"},{default:m(()=>[n.value?(p(),h("div",he,[t("div",we,[e[18]||(e[18]=t("h4",{class:"section-title"},"åŸºæœ¬ä¿¡æ¯",-1)),t("div",ye,[e[14]||(e[14]=t("span",{class:"label"},"æœºæ„ç±»å‹ï¼š",-1)),t("span",Ce,i(s.getOrgTypeText(n.value.org_type)),1)]),t("div",Se,[e[15]||(e[15]=t("span",{class:"label"},"è”ç³»ä¿¡æ¯ï¼š",-1)),t("span",be,i(n.value.contact_info||"æœªè®¾ç½®"),1)]),t("div",ke,[e[16]||(e[16]=t("span",{class:"label"},"æœºæ„åœ°å€ï¼š",-1)),t("span",Oe,i(n.value.address||"æœªè®¾ç½®"),1)]),n.value.description?(p(),h("div",$e,[e[17]||(e[17]=t("span",{class:"label"},"æœºæ„æè¿°ï¼š",-1)),t("span",De,i(n.value.description),1)])):b("",!0)]),t("div",Ve,[e[21]||(e[21]=t("h4",{class:"section-title"},"ç»Ÿè®¡ä¿¡æ¯",-1)),t("div",Te,[e[19]||(e[19]=t("span",{class:"label"},"åˆ›å»ºæ—¶é—´ï¼š",-1)),t("span",xe,i(z(n.value.created_at)),1)]),t("div",ze,[e[20]||(e[20]=t("span",{class:"label"},"æœ€åæ›´æ–°ï¼š",-1)),t("span",Be,i(z(n.value.updated_at)),1)])])])):b("",!0)]),_:1},8,["show","title"])])}}},Ie=P(Ue,[["__scopeId","data-v-a348ab0d"]]);export{Ie as default};
